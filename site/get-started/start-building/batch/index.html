
<!doctype html>
<html lang="en" class="no-js">
  <head>
     
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This guide provides examples and instructions on how to create, submit, retrieve, and manage batch inference jobs using kluster.ai's OpenAI-compatible API.">
      
      
      
        <link rel="canonical" href="https://docs.kluster.ai/get-started/start-building/batch/">
      
      
        <link rel="prev" href="../real-time/">
      
      
        <link rel="next" href="../../openai-compatibility/">
      
      
      <link rel="icon" href="../../../assets/images/favicon-dark-mode.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
      
    <title>Perform batch inference jobs | kluster.ai Docs</title>
     
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--code:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.6 16.6 4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4m-5.2 0L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4Z"/></svg>');}</style>



    
<link rel="stylesheet" href="../../../assets/stylesheets/kluster.css" />
<link
  href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@500&display=swap"
  rel="stylesheet"
/>

    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Space+Grotesk:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Space Grotesk";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/terminal.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/timeline-neoteroi.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-XXX"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-XXX",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-XXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#perform-batch-inference-jobs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
              </button>
            
            
<p>
  Qwen 3 235B is here! kluster.ai now supports it. Try it with
  <a href="/get-started/start-building/real-time/#quickstart-snippets"
    >real-time</a
  >
  or
  <a href="/get-started/start-building/batch/#quickstart-snippets">batch</a>
  inference.
</p>

          </div>
          
            <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <a href="https://docs.kluster.ai/" title="kluster.ai Docs" 
       class="md-header__button md-logo" 
       aria-label="kluster.ai Docs" 
       data-md-component="logo">
      
  <img src="../../../assets/images/logo.png" alt="logo">

    </a>
    
      
        
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
    
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
    
      
    
    Home
  
          <div class="framer-1w65mo2" data-framer-name="Bottom Border"></div>
        </a>
      </li>
    
  
      
        
    
    
      
    
    
      
      
        <li class="md-tabs__item md-tabs__item--active">
          <a href="../../get-api-key/" class="md-tabs__link">
            
    
    Get started
  
            <div class="framer-1w65mo2" data-framer-name="Bottom Border"></div>
          </a>
        </li>
      
    
  
      
        
    
    
    
      
      
        <li class="md-tabs__item">
          <a href="../../../api-reference/reference/" class="md-tabs__link">
            
    
    API reference
  
            <div class="framer-1w65mo2" data-framer-name="Bottom Border"></div>
          </a>
        </li>
      
    
  
      
        
    
    
    
      
      
        
    
    
    
      
      
        
    
    
    
      
      
        <li class="md-tabs__item">
          <a href="../../../tutorials/klusterai-api/text-classification/text-classification-openai-api/" class="md-tabs__link">
            
    
    Tutorials
  
            <div class="framer-1w65mo2" data-framer-name="Bottom Border"></div>
          </a>
        </li>
      
    
  
      
    
  
      
    
  
      
    </ul>
  </div>
</nav>
      
    
    <div class="md-header__buttons">
      
      <div class="button-container">
        <div class="framer-1suqwmq-container" data-framer-appear-id="1suqwmq">
          <a class="framer-Bja7l framer-1v7ikbi framer-v-1v7ikbi framer-aotcnd" 
             href="https://platform.kluster.ai/" 
             target="_blank" 
             rel="noopener" 
             data-framer-name="Variant 1">
            <div class="framer-follse" data-framer-name="Gradient Loop Stroke">
              <div data-framer-background-image-wrapper="true">
                <img decoding="async" src="/assets/images/rainbow.gif" alt="">
              </div>
            </div>
            <div class="framer-1a164ql" data-framer-name="Overlay"></div>
            <div class="framer-uvujyo" data-framer-name="BG"></div>
            <div class="framer-p6mefi" data-framer-component-type="RichTextContainer">
              <p class="framer-text">Start building</p>
            </div>
          </a>
        </div>
      </div>
      
        <label class="md-header__button md-icon" for="__search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
      
    </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
  
  
    
  
  
  <nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
    <label class="md-nav__title" for="__drawer">
      <a href="https://kluster.ai/" title="kluster.ai" class="md-nav__button md-logo" aria-label="kluster.ai" data-md-component="logo">
        
  <img src="../../../assets/images/logo.png" alt="logo">

      </a>
    </label>
    
    <ul class="md-nav__list" data-md-scrollfix>
      
        
        
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

      
        
        
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Get started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Get started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../get-api-key/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get an API key
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Start building
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Start building
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initial setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../real-time/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Real-time inferences
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Batch inferences
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Batch inferences
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-models" class="md-nav__link">
    <span class="md-ellipsis">
      Supported models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#batch-job-workflow-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Batch job workflow overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quickstart-snippets" class="md-nav__link">
    <span class="md-ellipsis">
      Quickstart snippets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quickstart snippets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    <span class="md-ellipsis">
      Python
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli" class="md-nav__link">
    <span class="md-ellipsis">
      CLI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#batch-inference-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Batch inference flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Batch inference flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-batch-jobs-as-json-files" class="md-nav__link">
    <span class="md-ellipsis">
      Create batch jobs as JSON files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upload-batch-job-files" class="md-nav__link">
    <span class="md-ellipsis">
      Upload batch job files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submit-a-batch-job" class="md-nav__link">
    <span class="md-ellipsis">
      Submit a batch job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-job-progress" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor job progress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieve-results" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieve results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-all-batch-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      List all batch jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cancel-a-batch-job" class="md-nav__link">
    <span class="md-ellipsis">
      Cancel a batch job
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openai-compatibility/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAI compatibility
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Integrations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Integrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/crewai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CrewAI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/eliza/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eliza
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/immersive-translate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Immersive Translate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/langchain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LangChain
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/litellm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LiteLLM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/msty/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Msty
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/pydantic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PydanticAI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/sillytavern/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SillyTavern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../integrations/typingmind/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TypingMind
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

      
        
        
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../api-reference/reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

      
        
        
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Use cases
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Use cases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Text classification
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_1">
            <span class="md-nav__icon md-icon"></span>
            Text classification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/klusterai-api/text-classification/text-classification-openai-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using OpenAI API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/klusterai-api/text-classification/text-classification-curator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Curator
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/klusterai-api/sentiment-analysis-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sentiment analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/klusterai-api/keyword-extraction-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keyword extraction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/klusterai-api/multiple-tasks-batch-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multiple batch predictions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/klusterai-api/model-comparison/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluating LLMs with labeled data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/klusterai-api/llm-as-a-judge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LLM as a judge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/klusterai-api/finetuning-sent-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fine-tuning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/klusterai-api/image-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Image analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/klusterai-api/uploads-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Uploading large files
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

      
    </ul>
  </nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-models" class="md-nav__link">
    <span class="md-ellipsis">
      Supported models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#batch-job-workflow-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Batch job workflow overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quickstart-snippets" class="md-nav__link">
    <span class="md-ellipsis">
      Quickstart snippets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quickstart snippets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    <span class="md-ellipsis">
      Python
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cli" class="md-nav__link">
    <span class="md-ellipsis">
      CLI
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#batch-inference-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Batch inference flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Batch inference flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-batch-jobs-as-json-files" class="md-nav__link">
    <span class="md-ellipsis">
      Create batch jobs as JSON files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upload-batch-job-files" class="md-nav__link">
    <span class="md-ellipsis">
      Upload batch job files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submit-a-batch-job" class="md-nav__link">
    <span class="md-ellipsis">
      Submit a batch job
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-job-progress" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor job progress
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieve-results" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieve results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-all-batch-jobs" class="md-nav__link">
    <span class="md-ellipsis">
      List all batch jobs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cancel-a-batch-job" class="md-nav__link">
    <span class="md-ellipsis">
      Cancel a batch job
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
  
  <article class="md-content__inner md-typeset ">
     


<h1 id="perform-batch-inference-jobs">Perform batch inference jobs<a class="headerlink" href="#perform-batch-inference-jobs" title="Permanent link">＃</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">＃</a></h2>
<p>This guide provides examples and instructions on how to create, submit, retrieve, and manage batch inference jobs using the <a href="https://www.kluster.ai/" target="_blank">kluster.ai</a> API. You will find guidance about preparing your data, selecting a model, submitting your batch job, and retrieving your results. Please make sure you check the <a href="/get-started/models/#api-request-limits" target="_blank">API request limits</a>.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">＃</a></h2>
<p>This guide assumes familiarity with Large Language Model (LLM) development and OpenAI libraries. Before getting started, make sure you have:</p>
<ul>
<li><strong>A kluster.ai account</strong> - sign up on the <a href="https://platform.kluster.ai/signup" target="_blank">kluster.ai platform</a> if you don't have one</li>
<li><strong>A kluster.ai API key</strong> - after signing in, go to the <a href="https://platform.kluster.ai/apikeys" target="_blank"><strong>API Keys</strong></a> section and create a new key. For detailed instructions, check out the <a href="/get-started/get-api-key/" target="_blank">Get an API key</a> guide</li>
<li><strong>A virtual Python environment</strong> - (optional) recommended for developers using Python. It helps isolate Python installations in a <a href="https://packaging.python.org/en/latest/guides/installing-using-pip-and-virtual-environments/" target="_blank">virtual environment</a> to reduce the risk of environment or package conflicts between your projects</li>
<li><strong>Required Python libraries</strong> - install the following Python libraries:<ul>
<li><a href="https://pypi.org/project/openai/"><strong>OpenAI Python API library</strong></a> - to access the <code>openai</code> module</li>
<li><a href="https://pypi.org/project/getpass4/"><strong><code>getpass</code></strong></a> - to handle API keys safely</li>
</ul>
</li>
<li><strong>A basic understanding of</strong> <a href="https://jsonlines.org/" target="_blank"><strong>JSON Lines (JSONL)</strong></a> - JSONL is the required text input format for performing batch inferences with the kluster.ai API</li>
</ul>
<p>If you plan to use cURL via the CLI, you can export your kluster.ai API key as a variable:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">API_KEY</span><span class="o">=</span>INSERT_API_KEY
</code></pre></div>
<h2 id="supported-models">Supported models<a class="headerlink" href="#supported-models" title="Permanent link">＃</a></h2>
<p>Please visit the <a href="/get-started/models/" target="_blank">Models</a> page to learn more about all the models supported by the kluster.ai batch API.</p>
<p>In addition, you can see the complete list of available models programmatically using the <a href="/api-reference/reference/#list-supported-models" target="_blank">list supported models</a> endpoint.</p>
<h2 id="batch-job-workflow-overview">Batch job workflow overview<a class="headerlink" href="#batch-job-workflow-overview" title="Permanent link">＃</a></h2>
<p>Working with batch jobs in the kluster.ai API involves the following steps:</p>
<ol>
<li><strong>Create batch job file</strong> - prepare a JSON Lines file containing one or more chat completion requests to execute in the batch</li>
<li><strong>Upload batch job file</strong> - upload the file to kluster.ai to receive a unique file ID</li>
<li><strong>Start the batch job</strong> - initiate a new batch job using the file ID</li>
<li><strong>Monitor job progress</strong> - track the status of your batch job to ensure successful completion</li>
<li><strong>Retrieve results</strong> - once the job finishes, access and process the results as needed</li>
</ol>
<p>In addition to these core steps, this guide will give you hands-on experience to:</p>
<ul>
<li><strong>Cancel a batch job</strong> - cancel an ongoing batch job before it completes</li>
<li><strong>List all batch jobs</strong> - review all of your batch jobs</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For the free tier, the maximum number of batch requests (lines in the JSONL file) must be less than 1000, and each file must not exceed 100 MB. For the standard tier, there is no limit to the number of batch requests, but the maximum batch file size is 100 MB per file.</p>
</div>
<h2 id="quickstart-snippets">Quickstart snippets<a class="headerlink" href="#quickstart-snippets" title="Permanent link">＃</a></h2>
<p>The following code snippets provide a full end-to-end batch inference example for different models supported by kluster.ai. You can simply copy and paste the snippet into your local environment.</p>
<h3 id="python">Python<a class="headerlink" href="#python" title="Permanent link">＃</a></h3>
<p>To use these snippets, run the Python script and enter your kluster.ai API key when prompted.</p>
<details class="example">
<summary>DeepSeek R1</summary>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Get API key from user input</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="p">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-R1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are an experienced cook.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the ultimate breakfast sandwich?&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-R1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a maths tutor.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem.&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-R1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a multilingual, experienced maths tutor.&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem in Spanish&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="c1"># Additional tasks can be added here</span>
<span class="p">]</span>

<span class="c1"># Save tasks to a JSONL file (newline-delimited JSON)</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;my_batch_request.jsonl&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Upload batch job file</span>
<span class="n">batch_input_file</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">),</span>
        <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span>
<span class="p">)</span>

<span class="c1"># Submit batch job</span>
<span class="n">batch_request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">input_file_id</span><span class="o">=</span><span class="n">batch_input_file</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
    <span class="n">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Poll the batch status until it&#39;s complete</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">batch_status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">batch_request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Batch status: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Completed tasks: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">completed</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;cancelled&quot;</span><span class="p">]:</span>
        <span class="k">break</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Wait for 10 seconds before checking again</span>

<span class="c1"># Check if the Batch completed successfully</span>
<span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
    <span class="c1"># Retrieve the results and log</span>
    <span class="n">result_file_id</span> <span class="o">=</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">output_file_id</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">content</span><span class="p">(</span><span class="n">result_file_id</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

    <span class="c1"># Print response to console</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔍 AI batch response:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch failed with status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="example">
<summary>DeepSeek V3 0324</summary>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Get API key from user input</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="p">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-V3-0324&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are an experienced cook.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the ultimate breakfast sandwich?&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-V3-0324&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a maths tutor.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem.&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-V3-0324&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a multilingual, experienced maths tutor.&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem in Spanish&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="c1"># Additional tasks can be added here</span>
<span class="p">]</span>

<span class="c1"># Save tasks to a JSONL file (newline-delimited JSON)</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;my_batch_request.jsonl&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Upload batch job file</span>
<span class="n">batch_input_file</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">),</span>
        <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span>
<span class="p">)</span>

<span class="c1"># Submit batch job</span>
<span class="n">batch_request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">input_file_id</span><span class="o">=</span><span class="n">batch_input_file</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
    <span class="n">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Poll the batch status until it&#39;s complete</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">batch_status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">batch_request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Batch status: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Completed tasks: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">completed</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;cancelled&quot;</span><span class="p">]:</span>
        <span class="k">break</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Wait for 10 seconds before checking again</span>

<span class="c1"># Check if the Batch completed successfully</span>
<span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
    <span class="c1"># Retrieve the results and log</span>
    <span class="n">result_file_id</span> <span class="o">=</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">output_file_id</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">content</span><span class="p">(</span><span class="n">result_file_id</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

    <span class="c1"># Print response to console</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔍 AI batch response:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch failed with status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="example">
<summary>Gemma 3 27B</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>

<span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="c1"># Newton&#39;s cradle</span>
<span class="n">image1_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/balls-image.jpeg?raw=true&quot;</span>
<span class="c1"># Text with typos</span>
<span class="n">image2_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/text-typo-image.jpeg?raw=true&quot;</span>
<span class="c1"># Parking sign</span>
<span class="n">image3_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;</span>

<span class="c1"># Get API key from user input</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="p">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;google/gemma-3-27b-it&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;What is this?&quot;</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">image1_url</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;google/gemma-3-27b-it&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Extract the text, find typos if any.&quot;</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">image2_url</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;google/gemma-3-27b-it&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Who can park in the area?&quot;</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">image3_url</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="c1"># Save tasks to a JSONL file (newline-delimited JSON)</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;my_batch_request.jsonl&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Upload batch job file</span>
<span class="n">batch_input_file</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">),</span> <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">)</span>

<span class="c1"># Submit batch job</span>
<span class="n">batch_request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">input_file_id</span><span class="o">=</span><span class="n">batch_input_file</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
    <span class="n">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Poll the batch status until it&#39;s complete</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">batch_status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">batch_request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Completed tasks: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">completed</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;cancelled&quot;</span><span class="p">]:</span>
        <span class="k">break</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Wait for 10 seconds before checking again</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image1 URL: </span><span class="si">{</span><span class="n">image1_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image2 URL: </span><span class="si">{</span><span class="n">image2_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image3 URL: </span><span class="si">{</span><span class="n">image3_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Check if the Batch completed successfully</span>
<span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
    <span class="c1"># Retrieve the results and log</span>
    <span class="n">result_file_id</span> <span class="o">=</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">output_file_id</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">content</span><span class="p">(</span><span class="n">result_file_id</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

    <span class="c1"># Print response to console</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔍 AI batch response:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch failed with status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">batch_status</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="example">
<summary>LLama 3.1 8B</summary>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Get API key from user input</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="p">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;klusterai/Meta-Llama-3.1-8B-Instruct-Turbo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are an experienced cook.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the ultimate breakfast sandwich?&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;klusterai/Meta-Llama-3.1-8B-Instruct-Turbo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a maths tutor.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem.&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;klusterai/Meta-Llama-3.1-8B-Instruct-Turbo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a multilingual, experienced maths tutor.&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem in Spanish&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="c1"># Additional tasks can be added here</span>
<span class="p">]</span>

<span class="c1"># Save tasks to a JSONL file (newline-delimited JSON)</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;my_batch_request.jsonl&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Upload batch job file</span>
<span class="n">batch_input_file</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">),</span>
        <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span>
<span class="p">)</span>

<span class="c1"># Submit batch job</span>
<span class="n">batch_request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">input_file_id</span><span class="o">=</span><span class="n">batch_input_file</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
    <span class="n">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Poll the batch status until it&#39;s complete</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">batch_status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">batch_request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Batch status: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Completed tasks: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">completed</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;cancelled&quot;</span><span class="p">]:</span>
        <span class="k">break</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Wait for 10 seconds before checking again</span>

<span class="c1"># Check if the Batch completed successfully</span>
<span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
    <span class="c1"># Retrieve the results and log</span>
    <span class="n">result_file_id</span> <span class="o">=</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">output_file_id</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">content</span><span class="p">(</span><span class="n">result_file_id</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

    <span class="c1"># Print response to console</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔍 AI batch response:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch failed with status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="example">
<summary>LLama 3.3 70B</summary>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Get API key from user input</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="p">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;klusterai/Meta-Llama-3.3-70B-Instruct-Turbo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are an experienced cook.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the ultimate breakfast sandwich?&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;klusterai/Meta-Llama-3.3-70B-Instruct-Turbo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a maths tutor.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem.&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;klusterai/Meta-Llama-3.3-70B-Instruct-Turbo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a multilingual, experienced maths tutor.&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem in Spanish&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="c1"># Additional tasks can be added here</span>
<span class="p">]</span>

<span class="c1"># Save tasks to a JSONL file (newline-delimited JSON)</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;my_batch_request.jsonl&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Upload batch job file</span>
<span class="n">batch_input_file</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">),</span>
        <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span>
<span class="p">)</span>

<span class="c1"># Submit batch job</span>
<span class="n">batch_request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">input_file_id</span><span class="o">=</span><span class="n">batch_input_file</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
    <span class="n">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Poll the batch status until it&#39;s complete</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">batch_status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">batch_request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Batch status: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Completed tasks: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">completed</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;cancelled&quot;</span><span class="p">]:</span>
        <span class="k">break</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Wait for 10 seconds before checking again</span>

<span class="c1"># Check if the Batch completed successfully</span>
<span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
    <span class="c1"># Retrieve the results and log</span>
    <span class="n">result_file_id</span> <span class="o">=</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">output_file_id</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">content</span><span class="p">(</span><span class="n">result_file_id</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

    <span class="c1"># Print response to console</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔍 AI batch response:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch failed with status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
<details class="example">
<summary>Llama 4 Maverick 17B 128E</summary>
<div class="highlight"><pre><span></span><code>from<span class="w"> </span>openai<span class="w"> </span>import<span class="w"> </span>OpenAI
from<span class="w"> </span>getpass<span class="w"> </span>import<span class="w"> </span>getpass
import<span class="w"> </span>json
import<span class="w"> </span><span class="nb">time</span>

<span class="c1"># Parking sign</span>
<span class="nv">image_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;</span>

<span class="c1"># Get API key from user input</span>
<span class="nv">api_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getpass<span class="o">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="o">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenAI<span class="o">(</span>
<span class="w">    </span><span class="nv">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span>,
<span class="w">    </span><span class="nv">api_key</span><span class="o">=</span>api_key,
<span class="o">)</span>

<span class="c1"># Create request with specified structure</span>
<span class="nv">requests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;custom_id&quot;</span>:<span class="w"> </span><span class="s2">&quot;request-1&quot;</span>,
<span class="w">        </span><span class="s2">&quot;method&quot;</span>:<span class="w"> </span><span class="s2">&quot;POST&quot;</span>,
<span class="w">        </span><span class="s2">&quot;url&quot;</span>:<span class="w"> </span><span class="s2">&quot;/v1/chat/completions&quot;</span>,
<span class="w">        </span><span class="s2">&quot;body&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;model&quot;</span>:<span class="w"> </span><span class="s2">&quot;meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8&quot;</span>,
<span class="w">            </span><span class="s2">&quot;messages&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                </span><span class="o">{</span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="s2">&quot;system&quot;</span>,<span class="w"> </span><span class="s2">&quot;content&quot;</span>:<span class="w"> </span><span class="s2">&quot;You are an experienced cook.&quot;</span><span class="o">}</span>,
<span class="w">                </span><span class="o">{</span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="s2">&quot;user&quot;</span>,<span class="w"> </span><span class="s2">&quot;content&quot;</span>:<span class="w"> </span><span class="s2">&quot;What is the ultimate breakfast sandwich?&quot;</span><span class="o">}</span>,
<span class="w">            </span><span class="o">]</span>,
<span class="w">            </span><span class="s2">&quot;max_completion_tokens&quot;</span>:<span class="w"> </span><span class="m">1000</span>,
<span class="w">        </span><span class="o">}</span>,
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;custom_id&quot;</span>:<span class="w"> </span><span class="s2">&quot;request-2&quot;</span>,
<span class="w">        </span><span class="s2">&quot;method&quot;</span>:<span class="w"> </span><span class="s2">&quot;POST&quot;</span>,
<span class="w">        </span><span class="s2">&quot;url&quot;</span>:<span class="w"> </span><span class="s2">&quot;/v1/chat/completions&quot;</span>,
<span class="w">        </span><span class="s2">&quot;body&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;model&quot;</span>:<span class="w"> </span><span class="s2">&quot;meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8&quot;</span>,
<span class="w">            </span><span class="s2">&quot;messages&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                </span><span class="o">{</span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="s2">&quot;system&quot;</span>,<span class="w"> </span><span class="s2">&quot;content&quot;</span>:<span class="w"> </span><span class="s2">&quot;You are a maths tutor.&quot;</span><span class="o">}</span>,
<span class="w">                </span><span class="o">{</span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="s2">&quot;user&quot;</span>,<span class="w"> </span><span class="s2">&quot;content&quot;</span>:<span class="w"> </span><span class="s2">&quot;Explain the Pythagorean theorem.&quot;</span><span class="o">}</span>,
<span class="w">            </span><span class="o">]</span>,
<span class="w">            </span><span class="s2">&quot;max_completion_tokens&quot;</span>:<span class="w"> </span><span class="m">1000</span>,
<span class="w">        </span><span class="o">}</span>,
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;custom_id&quot;</span>:<span class="w"> </span><span class="s2">&quot;request-3&quot;</span>,
<span class="w">        </span><span class="s2">&quot;method&quot;</span>:<span class="w"> </span><span class="s2">&quot;POST&quot;</span>,
<span class="w">        </span><span class="s2">&quot;url&quot;</span>:<span class="w"> </span><span class="s2">&quot;/v1/chat/completions&quot;</span>,
<span class="w">        </span><span class="s2">&quot;body&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;model&quot;</span>:<span class="w"> </span><span class="s2">&quot;meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8&quot;</span>,
<span class="w">            </span><span class="s2">&quot;messages&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                </span><span class="o">{</span>
<span class="w">                    </span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="s2">&quot;user&quot;</span>,
<span class="w">                    </span><span class="s2">&quot;content&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                        </span><span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="w"> </span><span class="s2">&quot;text&quot;</span>,<span class="w"> </span><span class="s2">&quot;text&quot;</span>:<span class="w"> </span><span class="s2">&quot;Who can park in the area?&quot;</span><span class="o">}</span>,
<span class="w">                        </span><span class="o">{</span>
<span class="w">                            </span><span class="s2">&quot;type&quot;</span>:<span class="w"> </span><span class="s2">&quot;image_url&quot;</span>,
<span class="w">                            </span><span class="s2">&quot;image_url&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                                </span><span class="s2">&quot;url&quot;</span>:<span class="w"> </span>image_url
<span class="w">                            </span><span class="o">}</span>,
<span class="w">                        </span><span class="o">}</span>,
<span class="w">                    </span><span class="o">]</span>,
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">]</span>,
<span class="w">            </span><span class="s2">&quot;max_completion_tokens&quot;</span>:<span class="w"> </span><span class="m">1000</span>,
<span class="w">        </span><span class="o">}</span>,
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="c1"># Additional tasks can be added here</span>
<span class="o">]</span>

<span class="c1"># Save tasks to a JSONL file (newline-delimited JSON)</span>
<span class="nv">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my_batch_request.jsonl&quot;</span>
with<span class="w"> </span>open<span class="o">(</span>file_name,<span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="o">)</span><span class="w"> </span>as<span class="w"> </span>file:
<span class="w">    </span><span class="k">for</span><span class="w"> </span>request<span class="w"> </span><span class="k">in</span><span class="w"> </span>requests:
<span class="w">        </span>file.write<span class="o">(</span>json.dumps<span class="o">(</span>request<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s2">&quot;\n&quot;</span><span class="o">)</span>

<span class="c1"># Upload batch job file</span>
<span class="nv">batch_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>client.files.create<span class="o">(</span>
<span class="w">        </span><span class="nv">file</span><span class="o">=</span>open<span class="o">(</span>file_name,<span class="w"> </span><span class="s2">&quot;rb&quot;</span><span class="o">)</span>,
<span class="w">        </span><span class="nv">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span>
<span class="o">)</span>

<span class="c1"># Submit batch job</span>
<span class="nv">batch_request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>client.batches.create<span class="o">(</span>
<span class="w">    </span><span class="nv">input_file_id</span><span class="o">=</span>batch_input_file.id,
<span class="w">    </span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span>,
<span class="w">    </span><span class="nv">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span>,
<span class="o">)</span>

<span class="c1"># Poll the batch status until it&#39;s complete</span>
<span class="k">while</span><span class="w"> </span>True:
<span class="w">    </span><span class="nv">batch_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>client.batches.retrieve<span class="o">(</span>batch_request.id<span class="o">)</span>
<span class="w">    </span>print<span class="o">(</span><span class="s2">&quot;Batch status: {}&quot;</span>.format<span class="o">(</span>batch_status.status<span class="o">))</span>
<span class="w">    </span>print<span class="o">(</span>
<span class="w">        </span>f<span class="s2">&quot;Completed tasks: {batch_status.request_counts.completed} / {batch_status.request_counts.total}&quot;</span>
<span class="w">    </span><span class="o">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>batch_status.status.lower<span class="o">()</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;completed&quot;</span>,<span class="w"> </span><span class="s2">&quot;failed&quot;</span>,<span class="w"> </span><span class="s2">&quot;cancelled&quot;</span><span class="o">]</span>:
<span class="w">        </span><span class="k">break</span>

<span class="w">    </span>time.sleep<span class="o">(</span><span class="m">10</span><span class="o">)</span><span class="w">  </span><span class="c1"># Wait for 10 seconds before checking again</span>

<span class="c1"># Check if the Batch completed successfully</span>
<span class="k">if</span><span class="w"> </span>batch_status.status.lower<span class="o">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span>:
<span class="w">    </span><span class="c1"># Retrieve the results and log</span>
<span class="w">    </span><span class="nv">result_file_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>batch_status.output_file_id
<span class="w">    </span><span class="nv">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>client.files.content<span class="o">(</span>result_file_id<span class="o">)</span>.content

<span class="w">    </span><span class="c1"># Print response to console</span>
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">&quot;\n🔍 AI batch response:&quot;</span><span class="o">)</span>
<span class="w">    </span>print<span class="o">(</span>results<span class="o">)</span>
<span class="k">else</span>:
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">&quot;Batch failed with status: {batch_status.status}&quot;</span><span class="o">)</span>
</code></pre></div>
</details>
<details class="example">
<summary>Llama 4 Scout 17B 16E</summary>
<div class="highlight"><pre><span></span><code>from<span class="w"> </span>openai<span class="w"> </span>import<span class="w"> </span>OpenAI
from<span class="w"> </span>getpass<span class="w"> </span>import<span class="w"> </span>getpass
import<span class="w"> </span>json
import<span class="w"> </span><span class="nb">time</span>

<span class="c1"># Parking sign</span>
<span class="nv">image_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;</span>

<span class="c1"># Get API key from user input</span>
<span class="nv">api_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getpass<span class="o">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="o">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenAI<span class="o">(</span>
<span class="w">    </span><span class="nv">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span>,
<span class="w">    </span><span class="nv">api_key</span><span class="o">=</span>api_key,
<span class="o">)</span>

<span class="c1"># Create request with specified structure</span>
<span class="nv">requests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;custom_id&quot;</span>:<span class="w"> </span><span class="s2">&quot;request-1&quot;</span>,
<span class="w">        </span><span class="s2">&quot;method&quot;</span>:<span class="w"> </span><span class="s2">&quot;POST&quot;</span>,
<span class="w">        </span><span class="s2">&quot;url&quot;</span>:<span class="w"> </span><span class="s2">&quot;/v1/chat/completions&quot;</span>,
<span class="w">        </span><span class="s2">&quot;body&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;model&quot;</span>:<span class="w"> </span><span class="s2">&quot;meta-llama/Llama-4-Scout-17B-16E-Instruct&quot;</span>,
<span class="w">            </span><span class="s2">&quot;messages&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                </span><span class="o">{</span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="s2">&quot;system&quot;</span>,<span class="w"> </span><span class="s2">&quot;content&quot;</span>:<span class="w"> </span><span class="s2">&quot;You are an experienced cook.&quot;</span><span class="o">}</span>,
<span class="w">                </span><span class="o">{</span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="s2">&quot;user&quot;</span>,<span class="w"> </span><span class="s2">&quot;content&quot;</span>:<span class="w"> </span><span class="s2">&quot;What is the ultimate breakfast sandwich?&quot;</span><span class="o">}</span>,
<span class="w">            </span><span class="o">]</span>,
<span class="w">            </span><span class="s2">&quot;max_completion_tokens&quot;</span>:<span class="w"> </span><span class="m">1000</span>,
<span class="w">        </span><span class="o">}</span>,
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;custom_id&quot;</span>:<span class="w"> </span><span class="s2">&quot;request-2&quot;</span>,
<span class="w">        </span><span class="s2">&quot;method&quot;</span>:<span class="w"> </span><span class="s2">&quot;POST&quot;</span>,
<span class="w">        </span><span class="s2">&quot;url&quot;</span>:<span class="w"> </span><span class="s2">&quot;/v1/chat/completions&quot;</span>,
<span class="w">        </span><span class="s2">&quot;body&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;model&quot;</span>:<span class="w"> </span><span class="s2">&quot;meta-llama/Llama-4-Scout-17B-16E-Instruct&quot;</span>,
<span class="w">            </span><span class="s2">&quot;messages&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                </span><span class="o">{</span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="s2">&quot;system&quot;</span>,<span class="w"> </span><span class="s2">&quot;content&quot;</span>:<span class="w"> </span><span class="s2">&quot;You are a maths tutor.&quot;</span><span class="o">}</span>,
<span class="w">                </span><span class="o">{</span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="s2">&quot;user&quot;</span>,<span class="w"> </span><span class="s2">&quot;content&quot;</span>:<span class="w"> </span><span class="s2">&quot;Explain the Pythagorean theorem.&quot;</span><span class="o">}</span>,
<span class="w">            </span><span class="o">]</span>,
<span class="w">            </span><span class="s2">&quot;max_completion_tokens&quot;</span>:<span class="w"> </span><span class="m">1000</span>,
<span class="w">        </span><span class="o">}</span>,
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;custom_id&quot;</span>:<span class="w"> </span><span class="s2">&quot;request-3&quot;</span>,
<span class="w">        </span><span class="s2">&quot;method&quot;</span>:<span class="w"> </span><span class="s2">&quot;POST&quot;</span>,
<span class="w">        </span><span class="s2">&quot;url&quot;</span>:<span class="w"> </span><span class="s2">&quot;/v1/chat/completions&quot;</span>,
<span class="w">        </span><span class="s2">&quot;body&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;model&quot;</span>:<span class="w"> </span><span class="s2">&quot;meta-llama/Llama-4-Scout-17B-16E-Instruct&quot;</span>,
<span class="w">            </span><span class="s2">&quot;messages&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                </span><span class="o">{</span>
<span class="w">                    </span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="s2">&quot;user&quot;</span>,
<span class="w">                    </span><span class="s2">&quot;content&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                        </span><span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="w"> </span><span class="s2">&quot;text&quot;</span>,<span class="w"> </span><span class="s2">&quot;text&quot;</span>:<span class="w"> </span><span class="s2">&quot;Who can park in the area?&quot;</span><span class="o">}</span>,
<span class="w">                        </span><span class="o">{</span>
<span class="w">                            </span><span class="s2">&quot;type&quot;</span>:<span class="w"> </span><span class="s2">&quot;image_url&quot;</span>,
<span class="w">                            </span><span class="s2">&quot;image_url&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">                                </span><span class="s2">&quot;url&quot;</span>:<span class="w"> </span>image_url
<span class="w">                            </span><span class="o">}</span>,
<span class="w">                        </span><span class="o">}</span>,
<span class="w">                    </span><span class="o">]</span>,
<span class="w">                </span><span class="o">}</span>
<span class="w">            </span><span class="o">]</span>,
<span class="w">            </span><span class="s2">&quot;max_completion_tokens&quot;</span>:<span class="w"> </span><span class="m">1000</span>,
<span class="w">        </span><span class="o">}</span>,
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="c1"># Additional tasks can be added here</span>
<span class="o">]</span>

<span class="c1"># Save tasks to a JSONL file (newline-delimited JSON)</span>
<span class="nv">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my_batch_request.jsonl&quot;</span>
with<span class="w"> </span>open<span class="o">(</span>file_name,<span class="w"> </span><span class="s2">&quot;w&quot;</span><span class="o">)</span><span class="w"> </span>as<span class="w"> </span>file:
<span class="w">    </span><span class="k">for</span><span class="w"> </span>request<span class="w"> </span><span class="k">in</span><span class="w"> </span>requests:
<span class="w">        </span>file.write<span class="o">(</span>json.dumps<span class="o">(</span>request<span class="o">)</span><span class="w"> </span>+<span class="w"> </span><span class="s2">&quot;\n&quot;</span><span class="o">)</span>

<span class="c1"># Upload batch job file</span>
<span class="nv">batch_input_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>client.files.create<span class="o">(</span>
<span class="w">        </span><span class="nv">file</span><span class="o">=</span>open<span class="o">(</span>file_name,<span class="w"> </span><span class="s2">&quot;rb&quot;</span><span class="o">)</span>,
<span class="w">        </span><span class="nv">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span>
<span class="o">)</span>

<span class="c1"># Submit batch job</span>
<span class="nv">batch_request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>client.batches.create<span class="o">(</span>
<span class="w">    </span><span class="nv">input_file_id</span><span class="o">=</span>batch_input_file.id,
<span class="w">    </span><span class="nv">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span>,
<span class="w">    </span><span class="nv">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span>,
<span class="o">)</span>

<span class="c1"># Poll the batch status until it&#39;s complete</span>
<span class="k">while</span><span class="w"> </span>True:
<span class="w">    </span><span class="nv">batch_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>client.batches.retrieve<span class="o">(</span>batch_request.id<span class="o">)</span>
<span class="w">    </span>print<span class="o">(</span><span class="s2">&quot;Batch status: {}&quot;</span>.format<span class="o">(</span>batch_status.status<span class="o">))</span>
<span class="w">    </span>print<span class="o">(</span>
<span class="w">        </span>f<span class="s2">&quot;Completed tasks: {batch_status.request_counts.completed} / {batch_status.request_counts.total}&quot;</span>
<span class="w">    </span><span class="o">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span>batch_status.status.lower<span class="o">()</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;completed&quot;</span>,<span class="w"> </span><span class="s2">&quot;failed&quot;</span>,<span class="w"> </span><span class="s2">&quot;cancelled&quot;</span><span class="o">]</span>:
<span class="w">        </span><span class="k">break</span>

<span class="w">    </span>time.sleep<span class="o">(</span><span class="m">10</span><span class="o">)</span><span class="w">  </span><span class="c1"># Wait for 10 seconds before checking again</span>

<span class="c1"># Check if the Batch completed successfully</span>
<span class="k">if</span><span class="w"> </span>batch_status.status.lower<span class="o">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span>:
<span class="w">    </span><span class="c1"># Retrieve the results and log</span>
<span class="w">    </span><span class="nv">result_file_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>batch_status.output_file_id
<span class="w">    </span><span class="nv">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>client.files.content<span class="o">(</span>result_file_id<span class="o">)</span>.content

<span class="w">    </span><span class="c1"># Print response to console</span>
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">&quot;\n🔍 AI batch response:&quot;</span><span class="o">)</span>
<span class="w">    </span>print<span class="o">(</span>results<span class="o">)</span>
<span class="k">else</span>:
<span class="w">    </span>print<span class="o">(</span>f<span class="s2">&quot;Batch failed with status: {batch_status.status}&quot;</span><span class="o">)</span>
</code></pre></div>
</details>
<details class="example">
<summary>Qwen 2.5 7B</summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>

<span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="c1"># Newton&#39;s cradle</span>
<span class="n">image1_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/balls-image.jpeg?raw=true&quot;</span>
<span class="c1"># Text with typos</span>
<span class="n">image2_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/text-typo-image.jpeg?raw=true&quot;</span>
<span class="c1"># Parking sign</span>
<span class="n">image3_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;</span>


<span class="c1"># Get API key from user input</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="p">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Qwen/Qwen2.5-VL-7B-Instruct&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;What is this?&quot;</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">image1_url</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Qwen/Qwen2.5-VL-7B-Instruct&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Extract the text, find typos if any.&quot;</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">image2_url</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Qwen/Qwen2.5-VL-7B-Instruct&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Who can park in the area?&quot;</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">image3_url</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="c1"># Save tasks to a JSONL file (newline-delimited JSON)</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;my_batch_request.jsonl&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Upload batch job file</span>
<span class="n">batch_input_file</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">),</span> <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">)</span>

<span class="c1"># Submit batch job</span>
<span class="n">batch_request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">input_file_id</span><span class="o">=</span><span class="n">batch_input_file</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
    <span class="n">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Poll the batch status until it&#39;s complete</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">batch_status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">batch_request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Completed tasks: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">completed</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;cancelled&quot;</span><span class="p">]:</span>
        <span class="k">break</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Wait for 10 seconds before checking again</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image1 URL: </span><span class="si">{</span><span class="n">image1_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image2 URL: </span><span class="si">{</span><span class="n">image2_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image3 URL: </span><span class="si">{</span><span class="n">image3_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Check if the Batch completed successfully</span>
<span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
    <span class="c1"># Retrieve the results and log</span>
    <span class="n">result_file_id</span> <span class="o">=</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">output_file_id</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">content</span><span class="p">(</span><span class="n">result_file_id</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

    <span class="c1"># Print response to console</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔍 AI batch response:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch failed with status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">batch_status</span><span class="p">)</span>
</code></pre></div>
</details>
<h3 id="cli">CLI<a class="headerlink" href="#cli" title="Permanent link">＃</a></h3>
<p>Similarly, the following curl commands showcase how to easily send a chat completion request to kluster.ai for the different supported models. This example assumes you've exported your kluster.ai API key as the variable <code>API_KEY</code>.</p>
<details class="example">
<summary>DeepSeek R1</summary>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check if API_KEY is set and not empty</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: API_KEY environment variable is not set.&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="k">fi</span>

<span class="c1"># Create request with specified structure</span>
cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; my_batch_request.jsonl</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-1&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;deepseek-ai/DeepSeek-R1&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced cook.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;What is the ultimate breakfast sandwich?&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-2&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;deepseek-ai/DeepSeek-R1&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced maths tutor.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Explain the Pythagorean theorem.&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-4&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;deepseek-ai/DeepSeek-R1&quot;, &quot;messages&quot;:[{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a multilingual, experienced maths tutor.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Explain the Pythagorean theorem in Spanish&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">EOF</span>

<span class="c1"># Upload batch job file</span>
<span class="nv">FILE_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: multipart/form-data&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;file=@my_batch_request.jsonl&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;purpose=batch&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File uploaded, file ID: </span><span class="nv">$FILE_ID</span><span class="s2">&quot;</span>

<span class="c1"># Submit batch job</span>
<span class="nv">BATCH_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">        &quot;input_file_id&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$FILE_ID</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;,</span>
<span class="s1">        &quot;endpoint&quot;: &quot;/v1/chat/completions&quot;,</span>
<span class="s1">        &quot;completion_window&quot;: &quot;24h&quot;</span>
<span class="s1">    }&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Batch job submitted, job ID: </span><span class="nv">$BATCH_ID</span><span class="s2">&quot;</span>


<span class="c1"># Poll the batch status until it&#39;s completed</span>
<span class="nv">STATUS</span><span class="o">=</span><span class="s2">&quot;in_progress&quot;</span>
<span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$STATUS</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Waiting for batch job to complete... Status: </span><span class="nv">$STATUS</span><span class="s2">&quot;</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># Wait for 10 seconds before checking again</span>

<span class="w">    </span><span class="nv">STATUS</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.status&#39;</span><span class="k">)</span>
<span class="k">done</span>

<span class="c1"># Retrieve the batch output file</span>
<span class="nv">KLUSTER_OUTPUT_FILE</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.output_file_id&#39;</span><span class="k">)</span>

<span class="c1"># Retrieve the results</span>
<span class="nv">OUTPUT_CONTENT</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files/<span class="nv">$KLUSTER_OUTPUT_FILE</span>/content<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="c1"># Log results</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n🔍 AI batch response:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_CONTENT</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<details class="example">
<summary>DeepSeek V3 0324</summary>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check if API_KEY is set and not empty</span>
<span class="k">if</span> <span class="p">[[</span> <span class="o">-</span><span class="n">z</span> <span class="s2">&quot;$API_KEY&quot;</span> <span class="p">]];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s2">&quot;Error: API_KEY environment variable is not set.&quot;</span> <span class="o">&gt;&amp;</span><span class="mi">2</span>
<span class="n">fi</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">my_batch_request</span><span class="o">.</span><span class="n">jsonl</span>
<span class="p">{</span><span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-V3-0324&quot;</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are an experienced cook.&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the ultimate breakfast sandwich?&quot;</span><span class="p">}],</span><span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span><span class="mi">1000</span><span class="p">}}</span>
<span class="p">{</span><span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-V3-0324&quot;</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are an experienced maths tutor.&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem.&quot;</span><span class="p">}],</span><span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span><span class="mi">1000</span><span class="p">}}</span>
<span class="p">{</span><span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-4&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-V3-0324&quot;</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a multilingual, experienced maths tutor.&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem in Spanish&quot;</span><span class="p">}],</span><span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span><span class="mi">1000</span><span class="p">}}</span>
<span class="n">EOF</span>

<span class="c1"># Upload batch job file</span>
<span class="n">FILE_ID</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">files</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: multipart/form-data&quot;</span> \
    <span class="o">-</span><span class="n">F</span> <span class="s2">&quot;file=@my_batch_request.jsonl&quot;</span> \
    <span class="o">-</span><span class="n">F</span> <span class="s2">&quot;purpose=batch&quot;</span> <span class="o">|</span> <span class="n">jq</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;.id&#39;</span><span class="p">)</span>
<span class="n">echo</span> <span class="s2">&quot;File uploaded, file ID: $FILE_ID&quot;</span>

<span class="c1"># Submit batch job</span>
<span class="n">BATCH_ID</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">batches</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> \
    <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{</span>
        <span class="s2">&quot;input_file_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&#39;&quot;</span><span class="err">$</span><span class="n">FILE_ID</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;completion_window&quot;</span><span class="p">:</span> <span class="s2">&quot;24h&quot;</span>
    <span class="p">}</span><span class="s1">&#39; | jq -r &#39;</span><span class="o">.</span><span class="n">id</span><span class="s1">&#39;)</span>
<span class="n">echo</span> <span class="s2">&quot;Batch job submitted, job ID: $BATCH_ID&quot;</span>


<span class="c1"># Poll the batch status until it&#39;s completed</span>
<span class="n">STATUS</span><span class="o">=</span><span class="s2">&quot;in_progress&quot;</span>
<span class="k">while</span> <span class="p">[[</span> <span class="s2">&quot;$STATUS&quot;</span> <span class="o">!=</span> <span class="s2">&quot;completed&quot;</span> <span class="p">]];</span> <span class="n">do</span>
    <span class="n">echo</span> <span class="s2">&quot;Waiting for batch job to complete... Status: $STATUS&quot;</span>
    <span class="n">sleep</span> <span class="mi">10</span> <span class="c1"># Wait for 10 seconds before checking again</span>

    <span class="n">STATUS</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">batches</span><span class="o">/</span><span class="err">$</span><span class="n">BATCH_ID</span> \
        <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
        <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">|</span> <span class="n">jq</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;.status&#39;</span><span class="p">)</span>
<span class="n">done</span>

<span class="c1"># Retrieve the batch output file</span>
<span class="n">KLUSTER_OUTPUT_FILE</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">batches</span><span class="o">/</span><span class="err">$</span><span class="n">BATCH_ID</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">|</span> <span class="n">jq</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;.output_file_id&#39;</span><span class="p">)</span>

<span class="c1"># Retrieve the results</span>
<span class="n">OUTPUT_CONTENT</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="err">$</span><span class="n">KLUSTER_OUTPUT_FILE</span><span class="o">/</span><span class="n">content</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span><span class="p">)</span>

<span class="c1"># Log results</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔍 AI batch response:&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;$OUTPUT_CONTENT&quot;</span>
</code></pre></div>
</details>
<details class="example">
<summary>Gemma 3 27B</summary>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check if API_KEY is set and not empty</span>
<span class="k">if</span> <span class="p">[[</span> <span class="o">-</span><span class="n">z</span> <span class="s2">&quot;$API_KEY&quot;</span> <span class="p">]];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s2">&quot;Error: API_KEY environment variable is not set.&quot;</span> <span class="o">&gt;&amp;</span><span class="mi">2</span>
<span class="n">fi</span>

<span class="c1"># Define image URLs</span>
<span class="c1"># Newton&#39;s cradle</span>
<span class="n">image1_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/balls-image.jpeg?raw=true&quot;</span>
<span class="c1"># Text with typos</span>
<span class="n">image2_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/text-typo-image.jpeg?raw=true&quot;</span>
<span class="c1"># Parking sign</span>
<span class="n">image3_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">my_batch_request</span><span class="o">.</span><span class="n">jsonl</span>
<span class="p">{</span><span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;google/gemma-3-27b-it&quot;</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;What is this?&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span> <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;$image1_url&quot;</span><span class="p">}}]}],</span><span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}}</span>
<span class="p">{</span><span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;google/gemma-3-27b-it&quot;</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Extract the text, find typos if any.&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span> <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;$image2_url&quot;</span><span class="p">}}]}],</span><span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}}</span>
<span class="p">{</span><span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-3&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;google/gemma-3-27b-it&quot;</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Who can park in the area?&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span> <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;$image3_url&quot;</span><span class="p">}}]}],</span><span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}}</span>
<span class="n">EOF</span>

<span class="c1"># Upload batch job file</span>
<span class="n">FILE_ID</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">files</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: multipart/form-data&quot;</span> \
    <span class="o">-</span><span class="n">F</span> <span class="s2">&quot;file=@my_batch_request.jsonl&quot;</span> \
    <span class="o">-</span><span class="n">F</span> <span class="s2">&quot;purpose=batch&quot;</span> <span class="o">|</span> <span class="n">jq</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;.id&#39;</span><span class="p">)</span>
<span class="n">echo</span> <span class="s2">&quot;File uploaded, file ID: $FILE_ID&quot;</span>

<span class="c1"># Submit batch job</span>
<span class="n">BATCH_ID</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">batches</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> \
    <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{</span>
        <span class="s2">&quot;input_file_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&#39;&quot;</span><span class="err">$</span><span class="n">FILE_ID</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;completion_window&quot;</span><span class="p">:</span> <span class="s2">&quot;24h&quot;</span>
    <span class="p">}</span><span class="s1">&#39; | jq -r &#39;</span><span class="o">.</span><span class="n">id</span><span class="s1">&#39;)</span>
<span class="n">echo</span> <span class="s2">&quot;Batch job submitted, job ID: $BATCH_ID&quot;</span>


<span class="c1"># Poll the batch status until it&#39;s completed</span>
<span class="n">STATUS</span><span class="o">=</span><span class="s2">&quot;in_progress&quot;</span>
<span class="k">while</span> <span class="p">[[</span> <span class="s2">&quot;$STATUS&quot;</span> <span class="o">!=</span> <span class="s2">&quot;completed&quot;</span> <span class="p">]];</span> <span class="n">do</span>
    <span class="n">echo</span> <span class="s2">&quot;Waiting for batch job to complete... Status: $STATUS&quot;</span>
    <span class="n">sleep</span> <span class="mi">10</span> <span class="c1"># Wait for 10 seconds before checking again</span>

    <span class="n">STATUS</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">batches</span><span class="o">/</span><span class="err">$</span><span class="n">BATCH_ID</span> \
        <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
        <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">|</span> <span class="n">jq</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;.status&#39;</span><span class="p">)</span>
<span class="n">done</span>

<span class="c1"># Retrieve the batch output file</span>
<span class="n">KLUSTER_OUTPUT_FILE</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">batches</span><span class="o">/</span><span class="err">$</span><span class="n">BATCH_ID</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">|</span> <span class="n">jq</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;.output_file_id&#39;</span><span class="p">)</span>

<span class="c1"># Retrieve the results</span>
<span class="n">OUTPUT_CONTENT</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="err">$</span><span class="n">KLUSTER_OUTPUT_FILE</span><span class="o">/</span><span class="n">content</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span><span class="p">)</span>

<span class="c1"># Log results</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image1 URL: $image1_url&quot;</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image2 URL: $image2_url&quot;</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image3 URL: $image3_url&quot;</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔍 AI batch response:&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;$OUTPUT_CONTENT&quot;</span>
</code></pre></div>
</details>
<details class="example">
<summary>LLama 3.1 8B</summary>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check if API_KEY is set and not empty</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: API_KEY environment variable is not set.&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="k">fi</span>

<span class="c1"># Create request with specified structure</span>
cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; my_batch_request.jsonl</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-1&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;klusterai/Meta-Llama-3.1-8B-Instruct-Turbo&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced cook.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;What is the ultimate breakfast sandwich?&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-2&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;klusterai/Meta-Llama-3.1-8B-Instruct-Turbo&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced maths tutor.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Explain the Pythagorean theorem.&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-4&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;klusterai/Meta-Llama-3.1-8B-Instruct-Turbo&quot;, &quot;messages&quot;:[{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a multilingual, experienced maths tutor.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Explain the Pythagorean theorem in Spanish&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">EOF</span>

<span class="c1"># Upload batch job file</span>
<span class="nv">FILE_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: multipart/form-data&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;file=@my_batch_request.jsonl&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;purpose=batch&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File uploaded, file ID: </span><span class="nv">$FILE_ID</span><span class="s2">&quot;</span>

<span class="c1"># Submit batch job</span>
<span class="nv">BATCH_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">        &quot;input_file_id&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$FILE_ID</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;,</span>
<span class="s1">        &quot;endpoint&quot;: &quot;/v1/chat/completions&quot;,</span>
<span class="s1">        &quot;completion_window&quot;: &quot;24h&quot;</span>
<span class="s1">    }&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Batch job submitted, job ID: </span><span class="nv">$BATCH_ID</span><span class="s2">&quot;</span>


<span class="c1"># Poll the batch status until it&#39;s completed</span>
<span class="nv">STATUS</span><span class="o">=</span><span class="s2">&quot;in_progress&quot;</span>
<span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$STATUS</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Waiting for batch job to complete... Status: </span><span class="nv">$STATUS</span><span class="s2">&quot;</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># Wait for 10 seconds before checking again</span>

<span class="w">    </span><span class="nv">STATUS</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.status&#39;</span><span class="k">)</span>
<span class="k">done</span>

<span class="c1"># Retrieve the batch output file</span>
<span class="nv">KLUSTER_OUTPUT_FILE</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.output_file_id&#39;</span><span class="k">)</span>

<span class="c1"># Retrieve the results</span>
<span class="nv">OUTPUT_CONTENT</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files/<span class="nv">$KLUSTER_OUTPUT_FILE</span>/content<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="c1"># Log results</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n🔍 AI batch response:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_CONTENT</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<details class="example">
<summary>LLama 3.3 70B</summary>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check if API_KEY is set and not empty</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: API_KEY environment variable is not set.&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="k">fi</span>

<span class="c1"># Create request with specified structure</span>
cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; my_batch_request.jsonl</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-1&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;klusterai/Meta-Llama-3.3-70B-Instruct-Turbo&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced cook.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;What is the ultimate breakfast sandwich?&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-2&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;klusterai/Meta-Llama-3.3-70B-Instruct-Turbo&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced maths tutor.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Explain the Pythagorean theorem.&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-4&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;klusterai/Meta-Llama-3.3-70B-Instruct-Turbo&quot;, &quot;messages&quot;:[{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a multilingual, experienced maths tutor.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Explain the Pythagorean theorem in Spanish&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">EOF</span>

<span class="c1"># Upload batch job file</span>
<span class="nv">FILE_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: multipart/form-data&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;file=@my_batch_request.jsonl&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;purpose=batch&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File uploaded, file ID: </span><span class="nv">$FILE_ID</span><span class="s2">&quot;</span>

<span class="c1"># Submit batch job</span>
<span class="nv">BATCH_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">        &quot;input_file_id&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$FILE_ID</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;,</span>
<span class="s1">        &quot;endpoint&quot;: &quot;/v1/chat/completions&quot;,</span>
<span class="s1">        &quot;completion_window&quot;: &quot;24h&quot;</span>
<span class="s1">    }&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Batch job submitted, job ID: </span><span class="nv">$BATCH_ID</span><span class="s2">&quot;</span>


<span class="c1"># Poll the batch status until it&#39;s completed</span>
<span class="nv">STATUS</span><span class="o">=</span><span class="s2">&quot;in_progress&quot;</span>
<span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$STATUS</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Waiting for batch job to complete... Status: </span><span class="nv">$STATUS</span><span class="s2">&quot;</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># Wait for 10 seconds before checking again</span>

<span class="w">    </span><span class="nv">STATUS</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.status&#39;</span><span class="k">)</span>
<span class="k">done</span>

<span class="c1"># Retrieve the batch output file</span>
<span class="nv">KLUSTER_OUTPUT_FILE</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.output_file_id&#39;</span><span class="k">)</span>

<span class="c1"># Retrieve the results</span>
<span class="nv">OUTPUT_CONTENT</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files/<span class="nv">$KLUSTER_OUTPUT_FILE</span>/content<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="c1"># Log results</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n🔍 AI batch response:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_CONTENT</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<details class="example">
<summary>Llama 4 Maverick 17B 128E</summary>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check if API_KEY is set and not empty</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: API_KEY environment variable is not set.&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="k">fi</span>

<span class="c1"># Parking sign</span>
<span class="nv">image_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;</span>

<span class="c1"># Create request with specified structure</span>
cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; my_batch_request.jsonl</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-1&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced cook.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;What is the ultimate breakfast sandwich?&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-2&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced maths tutor.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Explain the Pythagorean theorem.&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-3&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: [{&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: &quot;Who can park in the area?&quot;}, {&quot;type&quot;: &quot;image_url&quot;, &quot;image_url&quot;: {&quot;url&quot;: &quot;$image_url&quot;}}]}],&quot;max_completion_tokens&quot;: 1000}}</span>
<span class="s">EOF</span>

<span class="c1"># Upload batch job file</span>
<span class="nv">FILE_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: multipart/form-data&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;file=@my_batch_request.jsonl&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;purpose=batch&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File uploaded, file ID: </span><span class="nv">$FILE_ID</span><span class="s2">&quot;</span>

<span class="c1"># Submit batch job</span>
<span class="nv">BATCH_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">        &quot;input_file_id&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$FILE_ID</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;,</span>
<span class="s1">        &quot;endpoint&quot;: &quot;/v1/chat/completions&quot;,</span>
<span class="s1">        &quot;completion_window&quot;: &quot;24h&quot;</span>
<span class="s1">    }&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Batch job submitted, job ID: </span><span class="nv">$BATCH_ID</span><span class="s2">&quot;</span>


<span class="c1"># Poll the batch status until it&#39;s completed</span>
<span class="nv">STATUS</span><span class="o">=</span><span class="s2">&quot;in_progress&quot;</span>
<span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$STATUS</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Waiting for batch job to complete... Status: </span><span class="nv">$STATUS</span><span class="s2">&quot;</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># Wait for 10 seconds before checking again</span>

<span class="w">    </span><span class="nv">STATUS</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.status&#39;</span><span class="k">)</span>
<span class="k">done</span>

<span class="c1"># Retrieve the batch output file</span>
<span class="nv">KLUSTER_OUTPUT_FILE</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.output_file_id&#39;</span><span class="k">)</span>

<span class="c1"># Retrieve the results</span>
<span class="nv">OUTPUT_CONTENT</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files/<span class="nv">$KLUSTER_OUTPUT_FILE</span>/content<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="c1"># Log results</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n🔍 AI batch response:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_CONTENT</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<details class="example">
<summary>Llama 4 Scout 17B 16E</summary>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check if API_KEY is set and not empty</span>
<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Error: API_KEY environment variable is not set.&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="k">fi</span>

<span class="c1"># Parking sign</span>
<span class="nv">image_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;</span>

<span class="c1"># Create request with specified structure</span>
cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; my_batch_request.jsonl</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-1&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;meta-llama/Llama-4-Scout-17B-16E-Instruct&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced cook.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;What is the ultimate breakfast sandwich?&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-2&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;meta-llama/Llama-4-Scout-17B-16E-Instruct&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced maths tutor.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Explain the Pythagorean theorem.&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">{&quot;custom_id&quot;: &quot;request-3&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;meta-llama/Llama-4-Scout-17B-16E-Instruct&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: [{&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: &quot;Who can park in the area?&quot;}, {&quot;type&quot;: &quot;image_url&quot;, &quot;image_url&quot;: {&quot;url&quot;: &quot;$image_url&quot;}}]}],&quot;max_completion_tokens&quot;: 1000}}</span>
<span class="s">EOF</span>

<span class="c1"># Upload batch job file</span>
<span class="nv">FILE_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: multipart/form-data&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;file=@my_batch_request.jsonl&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;purpose=batch&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File uploaded, file ID: </span><span class="nv">$FILE_ID</span><span class="s2">&quot;</span>

<span class="c1"># Submit batch job</span>
<span class="nv">BATCH_ID</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">        &quot;input_file_id&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$FILE_ID</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;,</span>
<span class="s1">        &quot;endpoint&quot;: &quot;/v1/chat/completions&quot;,</span>
<span class="s1">        &quot;completion_window&quot;: &quot;24h&quot;</span>
<span class="s1">    }&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.id&#39;</span><span class="k">)</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Batch job submitted, job ID: </span><span class="nv">$BATCH_ID</span><span class="s2">&quot;</span>


<span class="c1"># Poll the batch status until it&#39;s completed</span>
<span class="nv">STATUS</span><span class="o">=</span><span class="s2">&quot;in_progress&quot;</span>
<span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$STATUS</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Waiting for batch job to complete... Status: </span><span class="nv">$STATUS</span><span class="s2">&quot;</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># Wait for 10 seconds before checking again</span>

<span class="w">    </span><span class="nv">STATUS</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.status&#39;</span><span class="k">)</span>
<span class="k">done</span>

<span class="c1"># Retrieve the batch output file</span>
<span class="nv">KLUSTER_OUTPUT_FILE</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.output_file_id&#39;</span><span class="k">)</span>

<span class="c1"># Retrieve the results</span>
<span class="nv">OUTPUT_CONTENT</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files/<span class="nv">$KLUSTER_OUTPUT_FILE</span>/content<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="k">)</span>

<span class="c1"># Log results</span>
<span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\n🔍 AI batch response:&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$OUTPUT_CONTENT</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<details class="example">
<summary>Qwen 2.5 7B</summary>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Check if API_KEY is set and not empty</span>
<span class="k">if</span> <span class="p">[[</span> <span class="o">-</span><span class="n">z</span> <span class="s2">&quot;$API_KEY&quot;</span> <span class="p">]];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s2">&quot;Error: API_KEY environment variable is not set.&quot;</span> <span class="o">&gt;&amp;</span><span class="mi">2</span>
<span class="n">fi</span>

<span class="c1"># Define image URLs</span>
<span class="c1"># Newton&#39;s cradle</span>
<span class="n">image1_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/balls-image.jpeg?raw=true&quot;</span>
<span class="c1"># Text with typos</span>
<span class="n">image2_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/text-typo-image.jpeg?raw=true&quot;</span>
<span class="c1"># Parking sign</span>
<span class="n">image3_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;</span> <span class="n">my_batch_request</span><span class="o">.</span><span class="n">jsonl</span>
<span class="p">{</span><span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Qwen/Qwen2.5-VL-7B-Instruct&quot;</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;What is this?&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span> <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;$image1_url&quot;</span><span class="p">}}]}],</span><span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}}</span>
<span class="p">{</span><span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Qwen/Qwen2.5-VL-7B-Instruct&quot;</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Extract the text, find typos if any.&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span> <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;$image2_url&quot;</span><span class="p">}}]}],</span><span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}}</span>
<span class="p">{</span><span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-3&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Qwen/Qwen2.5-VL-7B-Instruct&quot;</span><span class="p">,</span> <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Who can park in the area?&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span> <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;$image3_url&quot;</span><span class="p">}}]}],</span><span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}}</span>
<span class="n">EOF</span>

<span class="c1"># Upload batch job file</span>
<span class="n">FILE_ID</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">files</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: multipart/form-data&quot;</span> \
    <span class="o">-</span><span class="n">F</span> <span class="s2">&quot;file=@my_batch_request.jsonl&quot;</span> \
    <span class="o">-</span><span class="n">F</span> <span class="s2">&quot;purpose=batch&quot;</span> <span class="o">|</span> <span class="n">jq</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;.id&#39;</span><span class="p">)</span>
<span class="n">echo</span> <span class="s2">&quot;File uploaded, file ID: $FILE_ID&quot;</span>

<span class="c1"># Submit batch job</span>
<span class="n">BATCH_ID</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">batches</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> \
    <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;{</span>
        <span class="s2">&quot;input_file_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&#39;&quot;</span><span class="err">$</span><span class="n">FILE_ID</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;completion_window&quot;</span><span class="p">:</span> <span class="s2">&quot;24h&quot;</span>
    <span class="p">}</span><span class="s1">&#39; | jq -r &#39;</span><span class="o">.</span><span class="n">id</span><span class="s1">&#39;)</span>
<span class="n">echo</span> <span class="s2">&quot;Batch job submitted, job ID: $BATCH_ID&quot;</span>


<span class="c1"># Poll the batch status until it&#39;s completed</span>
<span class="n">STATUS</span><span class="o">=</span><span class="s2">&quot;in_progress&quot;</span>
<span class="k">while</span> <span class="p">[[</span> <span class="s2">&quot;$STATUS&quot;</span> <span class="o">!=</span> <span class="s2">&quot;completed&quot;</span> <span class="p">]];</span> <span class="n">do</span>
    <span class="n">echo</span> <span class="s2">&quot;Waiting for batch job to complete... Status: $STATUS&quot;</span>
    <span class="n">sleep</span> <span class="mi">10</span> <span class="c1"># Wait for 10 seconds before checking again</span>

    <span class="n">STATUS</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">batches</span><span class="o">/</span><span class="err">$</span><span class="n">BATCH_ID</span> \
        <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
        <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">|</span> <span class="n">jq</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;.status&#39;</span><span class="p">)</span>
<span class="n">done</span>

<span class="c1"># Retrieve the batch output file</span>
<span class="n">KLUSTER_OUTPUT_FILE</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">batches</span><span class="o">/</span><span class="err">$</span><span class="n">BATCH_ID</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">|</span> <span class="n">jq</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;.output_file_id&#39;</span><span class="p">)</span>

<span class="c1"># Retrieve the results</span>
<span class="n">OUTPUT_CONTENT</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">curl</span> <span class="o">-</span><span class="n">s</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">kluster</span><span class="o">.</span><span class="n">ai</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="err">$</span><span class="n">KLUSTER_OUTPUT_FILE</span><span class="o">/</span><span class="n">content</span> \
    <span class="o">-</span><span class="n">H</span> <span class="s2">&quot;Authorization: Bearer $API_KEY&quot;</span><span class="p">)</span>

<span class="c1"># Log results</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image1 URL: $image1_url&quot;</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image2 URL: $image2_url&quot;</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image3 URL: $image3_url&quot;</span>
<span class="n">echo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔍 AI batch response:&quot;</span>
<span class="n">echo</span> <span class="s2">&quot;$OUTPUT_CONTENT&quot;</span>
</code></pre></div>
</details>
<h2 id="batch-inference-flow">Batch inference flow<a class="headerlink" href="#batch-inference-flow" title="Permanent link">＃</a></h2>
<p>This section details the batch inference process using the kluster.ai API and DeepSeek R1 model, but you can adapt it to any of the <a href="/get-started/models/" target="_blank">supported models</a>.</p>
<h3 id="create-batch-jobs-as-json-files">Create batch jobs as JSON files<a class="headerlink" href="#create-batch-jobs-as-json-files" title="Permanent link">＃</a></h3>
<p>To begin the batch job workflow, you'll need to assemble your batch requests and add them to a <a href="https://jsonlines.org/" target="_blank">JSON Lines</a> file (<code>.jsonl</code>).</p>
<p>Each request must include the following arguments:</p>
<ul>
<li><code>custom_id</code> <span class="keys"><kbd>string</kbd></span> - a unique request ID to match outputs to inputs</li>
<li><code>method</code> <span class="keys"><kbd>string</kbd></span> - the HTTP method to use for the request. Currently, only <code>POST</code> is supported</li>
<li><code>url</code> <span class="keys"><kbd>string</kbd></span> -  the <code>/v1/chat/completions</code> endpoint</li>
<li><code>body</code> <span class="keys"><kbd>object</kbd></span> - a request body containing:<ul>
<li><code>model</code> <span class="keys"><kbd>string</kbd></span> <span class="required" markdown><span class="keys"><kbd>required</kbd></span></span> - name of one of the <a href="/get-started/models/" target="_blank">supported models</a></li>
<li><code>messages</code> <span class="keys"><kbd>array</kbd></span> <span class="required" markdown><span class="keys"><kbd>required</kbd></span></span> - a list of chat messages (<code>system</code>, <code>user</code>, or <code>assistant</code> roles, and also <code>image_url</code> for images)</li>
<li>Any optional <a href="/api-reference/reference/#create-chat-completion" target="_blank">chat completion parameters</a>, such as <code>temperature</code>, <code>max_completion_tokens</code>, etc.</li>
</ul>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use a different model for each request you submit.</p>
</div>
<p>The following examples generate requests and save them in a JSONL file, which is ready to be uploaded for processing.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Python</label><label for="__tabbed_1_2">CLI</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>

<span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="c1"># Get API key from user input</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="p">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-V3-0324&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are an experienced cook.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the ultimate breakfast sandwich?&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;klusterai/Meta-Llama-3.3-70B-Instruct-Turbo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a maths tutor.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem.&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Qwen/Qwen2.5-VL-7B-Instruct&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Who can park in the area?&quot;</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="c1"># Additional tasks can be added here</span>
<span class="p">]</span>

<span class="c1"># Save tasks to a JSONL file (newline-delimited JSON)</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;my_batch_request.jsonl&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; my_batch_request.jsonl</span>
<span class="s">    {&quot;custom_id&quot;: &quot;request-1&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;deepseek-ai/DeepSeek-V3-0324&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are an experienced cook.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;What is the ultimate breakfast sandwich?&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">    {&quot;custom_id&quot;: &quot;request-2&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;klusterai/Meta-Llama-3.3-70B-Instruct-Turbo&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a maths tutor.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Explain the Pythagorean theorem.&quot;}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">    {&quot;custom_id&quot;: &quot;request-3&quot;, &quot;method&quot;: &quot;POST&quot;, &quot;url&quot;: &quot;/v1/chat/completions&quot;, &quot;body&quot;: {&quot;model&quot;: &quot;Qwen/Qwen2.5-VL-7B-Instruct&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: [{&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: &quot;Who can park in the area?&quot;}, {&quot;type&quot;: &quot;image_url&quot;, &quot;image_url&quot;: {&quot;url&quot;: &quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;}}]}],&quot;max_completion_tokens&quot;:1000}}</span>
<span class="s">EOF</span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For the free tier, the maximum number of batch requests (lines in the JSONL file) must be less than 1000, and each file must not exceed 100 MB. For the standard tier, there is no limit to the number of batch requests, but the maximum batch file size is 100 MB per file. </p>
</div>
<h3 id="upload-batch-job-files">Upload batch job files<a class="headerlink" href="#upload-batch-job-files" title="Permanent link">＃</a></h3>
<p>After you've created the JSON Lines file, you need to upload it using the <code>files</code> endpoint along with the intended purpose. Consequently, you need to set the <code>purpose</code> value to <code>"batch"</code> for batch jobs.</p>
<p>The response will contain an <code>id</code> field; save this value as you'll need it in the next step, where it's referred to as <code>input_file_id</code>. You can view your uploaded files in the <a href="https://platform.kluster.ai/files" target="_blank"><strong>Files</strong> tab</a> of the kluster.ai platform.</p>
<p>Use the following command examples to upload your batch job files:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Python</label><label for="__tabbed_2_2">curl</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># Upload batch job file</span>
<span class="n">batch_input_file</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">),</span> <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: multipart/form-data&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;file=@my_batch_request.jsonl&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-F<span class="w"> </span><span class="s2">&quot;purpose=batch&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<div class="highlight"><span class="filename">Response</span><pre><span></span><code><span class="p">{</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myfile-123&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;bytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2797</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733832768&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;filename&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my_batch_request.jsonl&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;file&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;purpose&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;batch&quot;</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Remember that the maximum file size permitted is 100 MB.</p>
</div>
<h3 id="submit-a-batch-job">Submit a batch job<a class="headerlink" href="#submit-a-batch-job" title="Permanent link">＃</a></h3>
<p>Next, submit a batch job by calling the <code>batches</code> endpoint and providing the <code>id</code> of the uploaded batch job file (from the previous section) as the <a href="/api-reference/reference/#submit-a-batch-job" target="_blank"><code>input_file_id</code>, and additional parameters</a> to specify the job's configuration.</p>
<p>The response includes an <code>id</code> that can be used to monitor the job's progress, as demonstrated in the next section.</p>
<p>You can use the following snippets to submit your batch job:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Python</label><label for="__tabbed_3_2">curl</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># Submit batch job</span>
<span class="n">batch_request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">input_file_id</span><span class="o">=</span><span class="n">batch_input_file</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
    <span class="n">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;input_file_id&quot;: &quot;myfile-123&quot;,</span>
<span class="s1">    &quot;endpoint&quot;: &quot;/v1/chat/completions&quot;,</span>
<span class="s1">    &quot;completion_window&quot;: &quot;24h&quot;</span>
<span class="s1">    }&#39;</span>
</code></pre></div>
</div>
</div>
</div>
<div class="highlight"><span class="filename">Response</span><pre><span></span><code><span class="p">{</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mybatch-123&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;completion_window&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1733832777</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;endpoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;input_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myfile-123&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;batch&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;validating&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;cancelled_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;cancelling_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;completed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;error_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;expired_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;expires_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1733919177</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;failed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;finalizing_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;in_progress_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;output_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;request_counts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;completed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="monitor-job-progress">Monitor job progress<a class="headerlink" href="#monitor-job-progress" title="Permanent link">＃</a></h3>
<p>You can make periodic requests to the <code>batches</code> endpoint to monitor your batch job's progress. Use the <code>id</code> of the batch request from the preceding section as the <a href="/api-reference/reference/#retrieve-a-batch" target="_blank"><code>batch_id</code></a> to check its status. The job is complete when the <code>status</code> field returns <code>"completed"</code>. You can also monitor jobs in the <a href="https://platform.kluster.ai/batch"><strong>Batch</strong> tab</a> of the kluster.ai platform UI.</p>
<p>To see a complete list of the supported statuses, refer to the <a href="/api-reference/reference/#retrieve-a-batch" target="_blank">Retrieve a batch</a> API reference page.</p>
<p>You can use the following snippets to monitor your batch job:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Python</label><label for="__tabbed_4_2">curl</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># Poll the batch status until it&#39;s complete</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">batch_status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">batch_request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Completed tasks: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">completed</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;cancelled&quot;</span><span class="p">]:</span>
        <span class="k">break</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Wait for 10 seconds before checking again</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/mybatch-123<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<div class="highlight"><span class="filename">Response</span><pre><span></span><code><span class="p">{</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mybatch-123&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;batch&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;endpoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;input_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myfile-123&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;completion_window&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;output_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myfile-123-output&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;error_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733832777&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;in_progress_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733832777&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;expires_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733919177&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;finalizing_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733832781&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;completed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733832781&quot;</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;failed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;expired_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;cancelling_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;cancelled_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;request_counts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;completed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w"> </span><span class="p">},</span>
<span class="err"> </span><span class="w"> </span><span class="err"> </span><span class="w"> </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="retrieve-results">Retrieve results<a class="headerlink" href="#retrieve-results" title="Permanent link">＃</a></h3>
<p>To retrieve the content of your batch jobs output file, send a request to the <code>files</code> endpoint specifying the <code>output_file_id</code>, which is returned from querying the batch's status (from the previous section).</p>
<p>The output file will be a JSONL file, where each line contains the <code>custom_id</code> from your input file request and the corresponding response.</p>
<p>You can use the following snippets to retrieve the results from your batch job:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Python</label><label for="__tabbed_5_2">curl</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># Check if the Batch completed successfully</span>
<span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
    <span class="c1"># Retrieve the results</span>
    <span class="n">result_file_id</span> <span class="o">=</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">output_file_id</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">content</span><span class="p">(</span><span class="n">result_file_id</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

    <span class="c1"># Save results to a file</span>
    <span class="n">result_file_name</span> <span class="o">=</span> <span class="s2">&quot;batch_results.jsonl&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">result_file_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;💾 Response saved to </span><span class="si">{</span><span class="n">result_file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch failed with status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/files/kluster-output-file-123/content<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>batch_results.jsonl
</code></pre></div>
</div>
</div>
</div>
<details class="code">
<summary>View the complete script</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>

<span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="c1"># Get API key from user input</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="p">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Create request with specified structure</span>
<span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;deepseek-ai/DeepSeek-V3-0324&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are an experienced cook.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the ultimate breakfast sandwich?&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;klusterai/Meta-Llama-3.3-70B-Instruct-Turbo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a maths tutor.&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Explain the Pythagorean theorem.&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;custom_id&quot;</span><span class="p">:</span> <span class="s2">&quot;request-3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Qwen/Qwen2.5-VL-7B-Instruct&quot;</span><span class="p">,</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Who can park in the area?&quot;</span><span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/kluster-ai/klusterai-cookbook/blob/main/images/parking-image.jpeg?raw=true&quot;</span>
                            <span class="p">},</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;max_completion_tokens&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="c1"># Additional tasks can be added here</span>
<span class="p">]</span>

<span class="c1"># Save tasks to a JSONL file (newline-delimited JSON)</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;my_batch_request.jsonl&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Upload batch job file</span>
<span class="n">batch_input_file</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">),</span> <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">)</span>

<span class="c1"># Submit batch job</span>
<span class="n">batch_request</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">input_file_id</span><span class="o">=</span><span class="n">batch_input_file</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
    <span class="n">completion_window</span><span class="o">=</span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Poll the batch status until it&#39;s complete</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">batch_status</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">batch_request</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Completed tasks: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">completed</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">request_counts</span><span class="o">.</span><span class="n">total</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;cancelled&quot;</span><span class="p">]:</span>
        <span class="k">break</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Wait for 10 seconds before checking again</span>

<span class="c1"># Check if the Batch completed successfully</span>
<span class="k">if</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;completed&quot;</span><span class="p">:</span>
    <span class="c1"># Retrieve the results</span>
    <span class="n">result_file_id</span> <span class="o">=</span> <span class="n">batch_status</span><span class="o">.</span><span class="n">output_file_id</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">content</span><span class="p">(</span><span class="n">result_file_id</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

    <span class="c1"># Save results to a file</span>
    <span class="n">result_file_name</span> <span class="o">=</span> <span class="s2">&quot;batch_results.jsonl&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">result_file_name</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;💾 Response saved to </span><span class="si">{</span><span class="n">result_file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch failed with status: </span><span class="si">{</span><span class="n">batch_status</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>
</details>
<h2 id="list-all-batch-jobs">List all batch jobs<a class="headerlink" href="#list-all-batch-jobs" title="Permanent link">＃</a></h2>
<p>To list all of your batch jobs, send a request to the <code>batches</code> endpoint without specifying a <code>batch_id</code>. To constrain the query response, you can also use a <code>limit</code> parameter.</p>
<p>You can use the following snippets to list all of your batch jobs:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Python</label><label for="__tabbed_7_2">curl</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>

<span class="c1"># Get API key from user input</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="p">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Log all batch jobs (limit to 3)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<div class="highlight"><span class="filename">Response</span><pre><span></span><code><span class="p">{</span>
<span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;list&quot;</span><span class="p">,</span>
<span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mybatch-123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;batch&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;endpoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;input_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myfile-123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;completion_window&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;completed&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myfile-123-output&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;error_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733832777&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;in_progress_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733832777&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;expires_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733919177&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;finalizing_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733832781&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;completed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1733832781&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;failed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;expired_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cancelling_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cancelled_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;request_counts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;completed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">},</span>
<span class="p">],</span>
<span class="nt">&quot;first_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mybatch-123&quot;</span><span class="p">,</span>
<span class="nt">&quot;last_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mybatch-789&quot;</span><span class="p">,</span>
<span class="nt">&quot;has_more&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="nt">&quot;count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="nt">&quot;page&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="nt">&quot;page_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="nt">&quot;items_per_page&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9223372036854775807</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="cancel-a-batch-job">Cancel a batch job<a class="headerlink" href="#cancel-a-batch-job" title="Permanent link">＃</a></h2>
<p>To cancel a batch job currently in progress, send a request to the <code>cancel</code> endpoint with your <code>batch_id</code>. Note that cancellation may take up to 10 minutes to complete, and the status will show as <code>canceling.</code> Once complete, the status will show as <code>cancelled</code>.</p>
<p>You can use the following snippets to cancel a batch job:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">Python</label><label for="__tabbed_8_2">curl</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><span class="filename">Example</span><pre><span></span><code><span class="kn">from</span> <span class="nn">openai</span> <span class="kn">import</span> <span class="n">OpenAI</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>

<span class="c1"># Get API key from user input</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Enter your kluster.ai API key: &quot;</span><span class="p">)</span>

<span class="c1"># Initialize OpenAI client pointing to kluster.ai API</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">OpenAI</span><span class="p">(</span>
    <span class="n">base_url</span><span class="o">=</span><span class="s2">&quot;https://api.kluster.ai/v1&quot;</span><span class="p">,</span>
    <span class="n">api_key</span><span class="o">=</span><span class="n">api_key</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Cancel batch job with specified ID</span>
<span class="n">client</span><span class="o">.</span><span class="n">batches</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="s2">&quot;mybatch-123&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><span class="filename">Example</span><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span>https://api.kluster.ai/v1/batches/<span class="nv">$BATCH_ID</span>/cancel<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="nv">$API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-X<span class="w"> </span>POST
</code></pre></div>
</div>
</div>
</div>
<div class="highlight"><span class="filename">Response</span><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mybatch-123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;batch&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;endpoint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/v1/chat/completions&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;errors&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;input_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myfile-123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;completion_window&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;24h&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cancelling&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;output_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;myfile-123-output&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;error_file_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;created_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1730821906&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;in_progress_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1730821911&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;expires_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1730821906&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;finalizing_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;completed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;failed_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;expired_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cancelling_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1730821906&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;cancelled_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;request_counts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;completed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;failed&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">＃</a></h2>
<p>You have now experienced the complete batch inference job lifecycle using kluster.ai's batch API. In this guide, you've learned how to:</p>
<ul>
<li>Prepare and submit batch jobs with structured request inputs</li>
<li>Track your job's progress in real-time</li>
<li>Retrieve and handle job results</li>
<li>View and manage your batch jobs</li>
<li>Cancel jobs when needed</li>
</ul>
<p>The kluster.ai batch API is designed to efficiently and reliably handle your large-scale LLM workloads. If you have questions or suggestions, the <a href="mailto:support@kluster.ai" target="_blank">support</a> team would love to hear from you.</p>







  
  



  



 
  </article>
</div>
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../real-time/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Real-time inferences">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Real-time inferences
              </div>
            </div>
          </a>
        
        
          
          <a href="../../openai-compatibility/" class="md-footer__link md-footer__link--next" aria-label="Next: OpenAI compatibility">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                OpenAI compatibility
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © 2025 kluster.ai. All rights reserved.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://discord.gg/klusterai" target="_blank" rel="noopener" title="Discord" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://twitter.com/klusterai" target="_blank" rel="noopener" title="X" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9L389.2 48zm-24.8 373.8h39.1L151.1 88h-42l255.3 333.8z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/company/kluster-ai/" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.instagram.com/klusterai/" target="_blank" rel="noopener" title="Instagram" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.facebook.com/profile.php?id=61558614587340" target="_blank" rel="noopener" title="Facebook" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.code.copy", "navigation.footer", "navigation.tabs", "navigation.tabs.sticky", "toc.follow"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
     
      <script src="../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="../../../js/custom_scroll.js"></script>
      
    
<script>
  const link = document.querySelector("link[rel~='icon']");
  if (link) {
    const isDarkMode = window.matchMedia(
      '(prefers-color-scheme: dark)'
    ).matches;
    isDarkMode
      ? (link.href = "../../../assets/images/favicon-dark-mode.png")
      : (link.href = "../../../assets/images/favicon-light-mode.png");
  }
</script>

  </body>
</html>